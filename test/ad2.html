<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Sci-Fi Dashboard — Beam Panel</title>
    <style>
        :root {
            --bg: #05040a;
            --panel-bg: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.06);
            --neon: #9b6bff;
            --neon-2: #6bdcff;
            --accent: linear-gradient(90deg, var(--neon), var(--neon-2));
            --glass-blur: 10px;
            --edge-glow: 1;
            --beam-intensity: 0.6;
        }

        /* page */
        html,
        body {
            height: 100%;
        }

        body {
            margin: 0;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Fira Code";
            background: radial-gradient(1200px 600px at 10% 10%, rgba(107, 220, 255, 0.03), transparent 8%),
                radial-gradient(800px 400px at 90% 85%, rgba(155, 107, 255, 0.03), transparent 8%),
                var(--bg);
            color: #e8e8f8;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 32px;
            box-sizing: border-box;
            overflow: hidden;
        }

        /* subtle starfield */
        .stars {
            position: absolute;
            inset: 0;
            pointer-events: none;
            opacity: .7;
        }

        .stars:after {
            content: "";
            position: absolute;
            inset: -50%;
            background-image:
                radial-gradient(rgba(255, 255, 255, 0.08) 0.5px, transparent 0.6px),
                radial-gradient(rgba(255, 255, 255, 0.045) 0.6px, transparent 0.7px);
            background-size: 3px 3px, 10px 10px;
            opacity: 0.9;
            transform: translateZ(0);
            filter: blur(.4px);
        }

        /* container */
        .canvas {
            width: 1100px;
            max-width: calc(100% - 64px);
            height: 640px;
            border-radius: 18px;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.6), 0 0 40px rgba(107, 60, 255, 0.04) inset;
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(var(--glass-blur));
            position: relative;
            overflow: hidden;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 18px;
            padding: 22px;
            outline: 1px solid transparent;
        }

        /* neon edge */
        .canvas:before {
            content: "";
            position: absolute;
            inset: 0;
            padding: 1px;
            border-radius: 18px;
            pointer-events: none;
            background: linear-gradient(90deg, rgba(155, 107, 255, 0.12), rgba(107, 220, 255, 0.06));
            mask: linear-gradient(#000, #000) content-box, linear-gradient(#000, #000);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            mix-blend-mode: screen;
            opacity: .95;
        }

        /* left / right panels */
        .panel {
            background: var(--panel-bg);
            border-radius: 12px;
            padding: 18px;
            display: flex;
            flex-direction: column;
            gap: 14px;
            border: 1px solid rgba(255, 255, 255, 0.03)
        }

        .left {
            height: 435px;
            padding: 28px;
            gap: 18px
        }

        .right {
            height: 435px;
            padding: 28px;
            gap: 12px
        }

        h1.title {
            font-size: 18px;
            margin: 0 0 6px 0;
            /* gradient text */
            background-image: linear-gradient(90deg, var(--neon), var(--neon-2));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            letter-spacing: 0.4px;
            font-weight: 700;
        }

        /* control row */
        .control {
            display: flex;
            align-items: center;
            gap: 12px
        }

        .label {
            min-width: 92px;
            font-size: 13px;
            color: rgba(232, 232, 248, 0.9);
            text-shadow: 0 6px 14px rgba(107, 60, 255, 0.02)
        }

        .label .glow {
            display: inline-block;
            padding: 6px 10px;
            border-radius: 6px;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.01), transparent);
            box-shadow: 0 0 24px rgba(155, 107, 255, 0.04) inset
        }

        /* inputs */
        input[type=range] {
            -webkit-appearance: none;
            height: 10px;
            border-radius: 6px;
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.04), rgba(255, 255, 255, 0.02));
            outline: none;
            padding: 0
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--neon);
            box-shadow: 0 6px 18px rgba(155, 107, 255, 0.18);
            border: 2px solid rgba(255, 255, 255, 0.12)
        }

        .numeric {
            width: 84px;
            padding: 8px;
            border-radius: 8px;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.03);
            color: inherit;
            text-align: center;
        }

        /* toggle */
        .toggle {
            width: 54px;
            height: 30px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.03);
            position: relative;
            padding: 4px;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.02);
            display: inline-block;
            vertical-align: middle;
        }

        .toggle .knob {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: linear-gradient(180deg, #fff2, #fff0);
            position: absolute;
            left: 4px;
            top: 4px;
            transition: all .22s cubic-bezier(.2, .9, .3, 1);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.45), 0 0 20px rgba(155, 107, 255, 0.06)
        }

        .toggle.on {
            background: linear-gradient(90deg, var(--neon), var(--neon-2));
        }

        .toggle.on .knob {
            left: 28px;
            box-shadow: 0 8px 36px rgba(155, 107, 255, 0.12)
        }

        .checkbox {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.06);
            display: inline-grid;
            place-items: center;
            cursor: pointer;
            background: rgba(0, 0, 0, 0.08)
        }

        .checkbox.checked {
            background: linear-gradient(90deg, var(--neon), var(--neon-2));
            box-shadow: 0 6px 20px rgba(155, 107, 255, 0.08) inset
        }

        /* right: Beam card */
        .beam-header {
            display: flex;
            align-items: center;
            justify-content: space-between
        }

        .beam-title {
            font-weight: 600;
            font-size: 16px
        }

        .beam-card {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.015), rgba(255, 255, 255, 0.006));
            padding: 12px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.03)
        }

        .events {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 10px
        }

        .event {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 10px;
            border-radius: 8px;
            border-left: 3px solid transparent
        }

        .event+.event {
            border-top: 1px solid rgba(255, 255, 255, 0.02)
        }

        .event .dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.5) inset
        }

        .event .meta {
            font-size: 13px;
            color: rgba(232, 232, 248, 0.9)
        }

        .event .time {
            font-size: 12px;
            color: rgba(232, 232, 248, 0.55)
        }

        /* holographic reflection */
        .holo {
            position: absolute;
            right: 40px;
            top: 20px;
            width: 420px;
            height: 360px;
            border-radius: 18px;
            pointer-events: none;
            mix-blend-mode: screen;
            opacity: 0.08;
            background: conic-gradient(from 120deg at 50% 50%, rgba(155, 107, 255, 0.18), transparent 25%, rgba(107, 220, 255, 0.08));
            filter: blur(40px)
        }

        /* beam preview panel */
        .preview {
            flex: 1;
            border-radius: 12px;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.022), rgba(255, 255, 255, 0.012));
            border: 1px solid rgba(255, 255, 255, 0.02);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden
        }

        .beam-visual {
            width: 86%;
            height: 58%;
            border-radius: 12px;
            background: linear-gradient(180deg, rgba(155, 107, 255, 0.08), rgba(107, 220, 255, 0.02));
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 30px 80px rgba(107, 60, 255, 0.06) inset;
            transform: translateZ(0)
        }

        .beam-core {
            width: 8%;
            height: 120%;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) scaleY(var(--beam-scale, 1));
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.6), rgba(155, 107, 255, 0.12));
            filter: blur(calc(var(--beam-blur, 10px)));
            opacity: var(--beam-intensity);
            box-shadow: 0 0 120px rgba(155, 107, 255, 0.22), 0 0 40px rgba(107, 220, 255, 0.08)
        }

        /* small UI niceties */
        .muted {
            color: rgba(232, 232, 248, 0.5);
            font-size: 12px
        }

        .spaced {
            display: flex;
            gap: 10px
        }

        /* animations */
        .glowPulse {
            animation: glow 3s ease-in-out infinite
        }

        /* full-width coding panel */
        .panel.bottom.coding-terminal {
            grid-column: 1 / span 2;
            background: linear-gradient(180deg, rgba(15, 15, 25, 0.9), rgba(8, 8, 14, 0.95));
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.04);
            font-family: "Fira Code", monospace;
            color: #9be4ff;
            overflow: hidden;
            box-shadow: 0 0 25px rgba(107, 220, 255, 0.06) inset;
        }

        /* Terminal Header */
        .terminal-header {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.04);
            padding: 6px 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .red {
            background: #ff5f56;
        }

        .yellow {
            background: #ffbd2e;
        }

        .green {
            background: #27c93f;
        }

        .term-title {
            margin-left: 8px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 13px;
            letter-spacing: 0.3px;
        }

        /* Code body */
        .terminal-body {
            padding: 18px;
            font-size: 14px;
            line-height: 1.6;
            height: 160px;
            overflow-y: auto;
            background: radial-gradient(circle at 30% 40%, rgba(107, 220, 255, 0.05), rgba(155, 107, 255, 0.02));
            color: #b8dfff;
        }

        code {
            white-space: pre;
            display: block;
        }

        .keyword {
            color: #ffb86b;
        }

        .function {
            color: #b59bff;
        }

        .string {
            color: #8cffb6;
        }

        .comment {
            color: rgba(255, 255, 255, 0.45);
            font-style: italic;
        }

        /* typing effect (subtle) */
        @keyframes typing {
            from {
                width: 0
            }

            to {
                width: 100%
            }
        }

        .terminal-body code {
            display: inline-block;
            white-space: pre;
            overflow: hidden;
            border-right: 2px solid #9be4ff;
            animation: typing 4.2s steps(40) 1;
        }

        @keyframes glow {
            0% {
                filter: drop-shadow(0 0 8px rgba(155, 107, 255, 0.08))
            }

            50% {
                filter: drop-shadow(0 0 26px rgba(155, 107, 255, 0.12))
            }

            100% {
                filter: drop-shadow(0 0 8px rgba(155, 107, 255, 0.08))
            }
        }

        /* small responsive improvements */
        @media (max-width:1120px) {
            .canvas {
                height: auto;
                grid-template-columns: 1fr;
                padding-bottom: 36px;
            }

            .left,
            .right {
                height: auto;
            }

            .holo {
                display: none;
            }
        }

        /* focus states for accessibility */
        .toggle:focus,
        .checkbox:focus,
        .numeric:focus,
        input[type=range]:focus {
            outline: 2px solid rgba(107, 220, 255, 0.12);
            outline-offset: 2px;
        }

        /* small inline controls area */
        .controls-actions {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: flex-end;
            margin-top: 6px;
        }

        .btn {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.06);
            padding: 8px 12px;
            border-radius: 8px;
            color: inherit;
            cursor: pointer;
            font-size: 13px;
        }

        .btn.primary {
            background: linear-gradient(90deg, var(--neon), var(--neon-2));
            border: none;
            color: #071728;
            font-weight: 600;
        }
    </style>
</head>

<body>
    <div class="stars" aria-hidden="true"></div>

    <div class="canvas" role="application" aria-label="Sci-Fi dashboard">
        <div class="panel left" aria-labelledby="controlsHeading">
            <div style="display:flex;align-items:center;justify-content:space-between">
                <div>
                    <h1 id="controlsHeading" class="title">Controls</h1>
                    <div class="muted">Tweak the UI & beam parameters</div>
                </div>
                <div class="muted">v1.0</div>
            </div>

            <div class="control">
                <div class="label"><span class="glow">Background</span></div>
                <div style="flex:1">
                    <input id="bgRange" type="range" min="0" max="100" value="8" aria-label="Background amount">
                </div>
                <input class="numeric" id="bgNum" type="number" min="0" max="100" value="8"
                    aria-label="Background number">
            </div>

            <div class="control">
                <div class="label"><span class="glow">Amount</span></div>
                <div style="flex:1">
                    <input id="amountRange" type="range" min="0" max="200" value="60" aria-label="Amount">
                </div>
                <input class="numeric" id="amountNum" type="number" min="0" max="200" value="60"
                    aria-label="Amount number">
            </div>

            <div class="control">
                <div class="label"><span class="glow">Opacity</span></div>
                <div style="flex:1">
                    <input id="opacityRange" type="range" min="0" max="100" value="65" aria-label="Opacity">
                </div>
                <input class="numeric" id="opacityNum" type="number" min="0" max="100" value="65"
                    aria-label="Opacity number">
            </div>

            <div class="control">
                <div class="label"><span class="glow">Intensity</span></div>
                <div style="flex:1">
                    <input id="intensityRange" type="range" min="0" max="200" value="120" aria-label="Intensity">
                </div>
                <input class="numeric" id="intensityNum" type="number" min="0" max="200" value="120"
                    aria-label="Intensity number">
            </div>

            <div style="display:flex;gap:12px;align-items:center;margin-top:6px">
                <div style="display:flex;flex-direction:column;gap:8px;flex:1">
                    <div class="control">
                        <div class="label">Live</div>
                        <div class="toggle on" id="liveToggle" role="switch" aria-checked="true" tabindex="0"
                            aria-label="Toggle live">
                            <div class="knob"></div>
                        </div>
                    </div>
                    <div class="control">
                        <div class="label">Auto-Sync</div>
                        <div class="toggle" id="syncToggle" role="switch" aria-checked="false" tabindex="0"
                            aria-label="Toggle auto sync">
                            <div class="knob"></div>
                        </div>
                    </div>
                </div>

                <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end">
                    <div class="control">
                        <div class="label">Glow</div>
                        <div class="checkbox checked" id="glowCb" role="checkbox" aria-checked="true" tabindex="0"
                            aria-label="Glow checkbox"></div>
                    </div>
                    <div class="control">
                        <div class="label">Holo</div>
                        <div class="checkbox" id="holoCb" role="checkbox" aria-checked="false" tabindex="0"
                            aria-label="Holographic overlay checkbox"></div>
                    </div>
                </div>
            </div>

            <div class="controls-actions" aria-hidden="false">
                <button id="resetBtn" class="btn" title="Reset to defaults">Reset</button>
                <button id="exportBtn" class="btn primary" title="Export HTML snapshot">Export</button>
            </div>

            <!-- Live readouts -->
            <div style="display:flex;justify-content:space-between;gap:12px;margin-top:8px">
                <div class="muted">Events: <strong id="eventCount">4</strong></div>
                <div class="muted">Light: <strong id="lightVal">60</strong></div>
                <div class="muted">Glow: <strong id="glowVal">120%</strong></div>
            </div>

        </div>

        <div class="panel right" aria-labelledby="beamHeading">
            <div style="display:flex;gap:18px;align-items:center">
                <div style="flex:1">
                    <div class="beam-header">
                        <div>
                            <div id="beamHeading" class="beam-title">Beam</div>
                            <div class="muted">Event log & live visualization</div>
                        </div>
                        <div class="muted">Status: <strong id="statusText">Online</strong></div>
                    </div>

                    <div class="beam-card" style="margin-top:12px">
                        <div style="display:flex;gap:12px;align-items:center">
                            <div
                                style="width:48px;height:48px;border-radius:10px;background:radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2), rgba(255,255,255,0.02));display:grid;place-items:center;font-weight:700">
                                B</div>
                            <div style="flex:1">
                                <div style="font-weight:600">Beam 01 — Focus Array</div>
                                <div class="muted">Core intensity & diagnostics</div>
                            </div>
                            <div class="muted">2.4s</div>
                        </div>

                        <div class="events" id="events" aria-live="polite" aria-atomic="false">
                            <!-- events injected by JS -->
                        </div>

                    </div>

                    <!-- preview -->
                    <div style="margin-top:14px" class="preview" aria-hidden="false">
                        <div class="beam-visual" id="beamVisual" aria-hidden="true">
                            <div class="beam-core" id="beamCore" aria-hidden="true"></div>
                        </div>
                    </div>

                </div>

            </div>
        </div>

        <div class="panel bottom coding-terminal" aria-label="Terminal logs">
            <div class="terminal-header">
                <div class="dot red"></div>
                <div class="dot yellow"></div>
                <div class="dot green"></div>
                <span class="term-title">beam_logs.js</span>
            </div>
            <div class="terminal-body" id="terminalBody" role="log" aria-live="polite">
                <code class="typed"><span class="comment">// Initializing Beam Core...</span>
<span class="keyword">const</span> beam = <span class="keyword">new</span> <span class="function">BeamSystem</span>({
  frequency: <span class="string">2.4</span>,
  intensity: <span class="string">"high"</span>,
  status: <span class="string">"active"</span>
});

beam.<span class="function">connect</span>(<span class="string">"focus-array"</span>);
beam.<span class="function">calibrate</span>();
console.<span class="function">log</span>(<span class="string">"%c[Beam Ready] →"</span>, <span class="string">"color:#6bdcff;"</span>, beam.status);
</code>
            </div>
        </div>

        <div class="holo" id="holo" aria-hidden="true"></div>
    </div>

    <script>
        // helper
        const qs = s => document.querySelector(s);
        const qsa = s => document.querySelectorAll(s);

        // controls
        const bgRange = qs('#bgRange'); const bgNum = qs('#bgNum');
        const amountRange = qs('#amountRange'); const amountNum = qs('#amountNum');
        const opacityRange = qs('#opacityRange'); const opacityNum = qs('#opacityNum');
        const intensityRange = qs('#intensityRange'); const intensityNum = qs('#intensityNum');

        const liveToggle = qs('#liveToggle'); const syncToggle = qs('#syncToggle');
        const glowCb = qs('#glowCb'); const holoCb = qs('#holoCb');
        const beamCore = qs('#beamCore'); const beamVisual = qs('#beamVisual');
        const eventsNode = qs('#events'); const holo = qs('#holo');
        const statusText = qs('#statusText'); const lightVal = qs('#lightVal'); const glowVal = qs('#glowVal');
        const eventCount = qs('#eventCount');

        // guard for required elements
        if (!beamCore || !beamVisual || !eventsNode) {
            console.warn('Missing required DOM elements — ensure beamCore, beamVisual, and events exist.');
        }

        // initialize
        function clamp(n, min, max) {
            if (Number.isNaN(n)) return min;
            return Math.min(max, Math.max(min, n));
        }

        function syncRangeAndNumber(range, number, options = {}) {
            const min = Number(range.min ?? options.min ?? 0);
            const max = Number(range.max ?? options.max ?? 100);
            range.addEventListener('input', () => {
                number.value = range.value;
                apply();
            });
            number.addEventListener('input', () => {
                // clamp and also sync range
                let v = Number(number.value);
                if (Number.isNaN(v)) v = min;
                v = clamp(v, min, max);
                number.value = v;
                range.value = v;
                apply();
            });
            // keep them consistent on blur (prevent empty)
            number.addEventListener('blur', () => {
                let v = Number(number.value);
                if (Number.isNaN(v)) v = min;
                v = clamp(v, min, max);
                number.value = v;
                range.value = v;
                apply();
            });
        }
        syncRangeAndNumber(bgRange, bgNum);
        syncRangeAndNumber(amountRange, amountNum);
        syncRangeAndNumber(opacityRange, opacityNum);
        syncRangeAndNumber(intensityRange, intensityNum);

        // keyboard + click toggles for accessibility
        function bindToggle(el) {
            if (!el) return;
            const toggleState = () => {
                el.classList.toggle('on');
                const isOn = el.classList.contains('on');
                el.setAttribute('aria-checked', String(isOn));
                apply();
            };
            el.addEventListener('click', toggleState);
            el.addEventListener('keydown', (ev) => {
                if (ev.key === 'Enter' || ev.key === ' ' || ev.key === 'Spacebar') {
                    ev.preventDefault();
                    toggleState();
                }
            });
        }
        bindToggle(liveToggle); bindToggle(syncToggle);

        function bindCheckbox(cb) {
            if (!cb) return;
            const toggle = () => {
                cb.classList.toggle('checked');
                const checked = cb.classList.contains('checked');
                cb.setAttribute('aria-checked', String(checked));
                apply();
            };
            cb.addEventListener('click', toggle);
            cb.addEventListener('keydown', (ev) => {
                if (ev.key === 'Enter' || ev.key === ' ' || ev.key === 'Spacebar') {
                    ev.preventDefault();
                    toggle();
                }
            });
        }
        [glowCb, holoCb].forEach(bindCheckbox);

        // events log dummy data
        const sampleEvents = [
            { t: '09:12:04', text: 'Calibration complete', color: '#6bdcff' },
            { t: '09:12:17', text: 'Intensity spike detected', color: '#ff7b7b' },
            { t: '09:12:32', text: 'Beam focus adjusted', color: '#b59bff' },
            { t: '09:12:50', text: 'Diagnostics OK', color: '#8cffb6' },
        ];

        function renderEvents() {
            eventsNode.innerHTML = '';
            sampleEvents.forEach((e, i) => {
                const div = document.createElement('div'); div.className = 'event';
                div.style.borderLeftColor = e.color;
                div.innerHTML = `<div style="width:12px;height:12px;border-radius:50%;background:${e.color}"></div>
                         <div style="flex:1">
                           <div class="meta">${escapeHtml(e.text)}</div>
                           <div class="time">${e.t}</div>
                         </div>
                         <div class="muted">#${i + 1}</div>`;
                eventsNode.appendChild(div);
            });
            // update event count readout
            if (eventCount) eventCount.textContent = sampleEvents.length;
        }

        function escapeHtml(s) {
            return String(s).replace(/[&<>"']/g, (m) => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m]));
        }

        renderEvents();

        // apply visuals based on controls
        function apply() {
            // background stars amount
            const bg = Number(bgRange.value);
            document.documentElement.style.setProperty('--bg', `radial-gradient(1200px 600px at 10% 10%, rgba(107,220,255,${clamp(bg / 200, 0, 1)}), transparent 8%), radial-gradient(800px 400px at 90% 85%, rgba(155,107,255,${clamp(bg / 220, 0, 1)}), transparent 8%), #05040a`);

            // amount -> blur/size of beam visual
            const amount = clamp(Number(amountRange.value), 0, 200);
            const scale = 0.6 + (amount / 200);
            if (beamCore) beamCore.style.setProperty('--beam-scale', scale);

            // opacity -> beam opacity
            const opacity = clamp(Number(opacityRange.value) / 100, 0, 1);
            if (beamCore) beamCore.style.opacity = opacity;

            // intensity -> glow strength
            const intensity = clamp(Number(intensityRange.value) / 100, 0, 2);
            document.documentElement.style.setProperty('--beam-intensity', String(intensity));
            if (beamCore) {
                beamCore.style.boxShadow = `0 0 ${40 + intensity * 120}px rgba(155,107,255,${0.18 * intensity}), 0 0 ${20 + intensity * 60}px rgba(107,220,255,${0.06 * intensity})`;
            }

            // live / sync -> status
            if (statusText) statusText.textContent = liveToggle.classList.contains('on') ? 'Online' : 'Standby';

            // glow checkbox
            const glowOn = glowCb.classList.contains('checked');
            if (beamVisual) {
                if (glowOn) { beamVisual.classList.add('glowPulse'); } else { beamVisual.classList.remove('glowPulse'); }
            }

            // holo
            holo.style.opacity = holoCb.classList.contains('checked') ? '0.12' : '0.02';
            holo.setAttribute('aria-hidden', String(!holoCb.classList.contains('checked')));

            // readouts
            if (lightVal) lightVal.textContent = Math.round(amount);
            if (glowVal) glowVal.textContent = Math.round(intensity * 100) + '%';
        }

        apply();

        // reset & export handlers (with safety)
        qs('#resetBtn').addEventListener('click', () => {
            bgRange.value = 8; bgNum.value = 8;
            amountRange.value = 60; amountNum.value = 60;
            opacityRange.value = 65; opacityNum.value = 65;
            intensityRange.value = 120; intensityNum.value = 120;
            liveToggle.classList.add('on'); liveToggle.setAttribute('aria-checked', 'true');
            syncToggle.classList.remove('on'); syncToggle.setAttribute('aria-checked', 'false');
            glowCb.classList.add('checked'); glowCb.setAttribute('aria-checked', 'true');
            holoCb.classList.remove('checked'); holoCb.setAttribute('aria-checked', 'false');
            sampleEvents.splice(0, sampleEvents.length, // reset to defaults
                { t: '09:12:04', text: 'Calibration complete', color: '#6bdcff' },
                { t: '09:12:17', text: 'Intensity spike detected', color: '#ff7b7b' },
                { t: '09:12:32', text: 'Beam focus adjusted', color: '#b59bff' },
                { t: '09:12:50', text: 'Diagnostics OK', color: '#8cffb6' },
            );
            renderEvents(); apply();
        });

        qs('#exportBtn').addEventListener('click', () => {
            // sanitize: strip out large JS timers by exporting current outerHTML
            const doc = document.documentElement.cloneNode(true);
            // remove scripts so the exported snapshot is static
            const scripts = doc.querySelectorAll('script');
            scripts.forEach(s => s.remove());
            const html = '<!doctype html>\n' + doc.outerHTML;
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = 'sci-fi-dashboard.html'; a.click(); URL.revokeObjectURL(url);
        });

        // small demo: push a new event every 9 seconds when live
        const demoInterval = setInterval(() => {
            if (!liveToggle.classList.contains('on')) return;
            const now = new Date();
            const t = now.toTimeString().slice(0, 8);
            const msgs = ['Beam stabilized', 'Micro-tweak applied', 'Temp nominal', 'Adaptive focus engaged', 'Signal nominal'];
            const colorPool = ['#6bdcff', '#b59bff', '#8cffb6', '#ffb86b', '#ff7b7b'];
            const color = colorPool[Math.floor(Math.random() * colorPool.length)];
            sampleEvents.unshift({ t, text: msgs[Math.floor(Math.random() * msgs.length)], color });
            // limit stored events
            sampleEvents.splice(6);
            renderEvents();
        }, 9000);

        // make sure to cleanup if page unloads (good practice)
        window.addEventListener('beforeunload', () => {
            clearInterval(demoInterval);
        });

        // small defensive: ensure numeric inputs sync on page load
        document.addEventListener('DOMContentLoaded', () => {
            [bgRange, amountRange, opacityRange, intensityRange].forEach((r) => {
                if (r) r.dispatchEvent(new Event('input'));
            });
        });

    </script>
</body>

</html>